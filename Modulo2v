local GUIModule = {}
GUIModule.__index = GUIModule

function GUIModule:Init(parent)
    self.Parent = parent
end

function GUIModule:CreateMenu(title)
    local menu = {}
    menu.Tabs = {}
    menu.Visible = false

    local player = game:GetService("Players").LocalPlayer
    local playerGui = player:WaitForChild("PlayerGui")

    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = title:gsub("%s+", "") .. "Menu"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = playerGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 400, 0, 300)
    frame.Position = UDim2.new(0.5, -200, 0.5, -150)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.Parent = screenGui

    local tabButtonsFrame = Instance.new("Frame")
    tabButtonsFrame.Size = UDim2.new(1, 0, 0, 30)
    tabButtonsFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    tabButtonsFrame.Parent = frame

    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1, 0, 1, -30)
    contentFrame.Position = UDim2.new(0, 0, 0, 30)
    contentFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    contentFrame.Parent = frame

    menu.ScreenGui = screenGui
    menu.Frame = frame
    menu.TabButtonsFrame = tabButtonsFrame
    menu.ContentFrame = contentFrame
    menu.TabGuiObjects = {}
    menu.CurrentTab = nil

    function menu:AddTab(name)
        local tab = {}
        tab.Name = name
        tab.Controls = {}

        local tabButton = Instance.new("TextButton")
        tabButton.Size = UDim2.new(0, 100, 1, 0)
        tabButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        tabButton.Text = name
        tabButton.Parent = menu.TabButtonsFrame

        tabButton.MouseButton1Click:Connect(function()
            menu:SelectTab(name)
        end)

        menu.TabGuiObjects[name] = {
            Button = tabButton,
            Container = Instance.new("Frame", menu.ContentFrame)
        }
        local container = menu.TabGuiObjects[name].Container
        container.Size = UDim2.new(1, 0, 1, 0)
        container.BackgroundTransparency = 1
        container.Visible = false

        function tab:AddButton(text, callback)
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(0, 150, 0, 30)
            btn.Position = UDim2.new(0, 10, 0, #tab.Controls * 35 + 10)
            btn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
            btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            btn.Text = text
            btn.Parent = container
            btn.MouseButton1Click:Connect(callback)
            table.insert(tab.Controls, btn)
            return btn
        end

        function tab:AddToggle(text, default, callback)
            local toggleFrame = Instance.new("Frame")
            toggleFrame.Size = UDim2.new(0, 150, 0, 30)
            toggleFrame.Position = UDim2.new(0, 10, 0, #tab.Controls * 35 + 10)
            toggleFrame.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
            toggleFrame.Parent = container

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0.7, 0, 1, 0)
            label.BackgroundTransparency = 1
            label.TextColor3 = Color3.fromRGB(255, 255, 255)
            label.Text = text
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = toggleFrame

            local toggleBtn = Instance.new("TextButton")
            toggleBtn.Size = UDim2.new(0.3, -5, 0.8, 0)
            toggleBtn.Position = UDim2.new(0.7, 5, 0.1, 0)
            toggleBtn.BackgroundColor3 = default and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
            toggleBtn.Text = default and "ON" or "OFF"
            toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
            toggleBtn.Parent = toggleFrame

            local state = default
            toggleBtn.MouseButton1Click:Connect(function()
                state = not state
                toggleBtn.BackgroundColor3 = state and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
                toggleBtn.Text = state and "ON" or "OFF"
                callback(state)
            end)
            table.insert(tab.Controls, toggleFrame)
            return toggleFrame
        end

        function tab:AddSlider(text, min, max, default, callback)
            local sliderFrame = Instance.new("Frame")
            sliderFrame.Size = UDim2.new(0, 150, 0, 40)
            sliderFrame.Position = UDim2.new(0, 10, 0, #tab.Controls * 45 + 10)
            sliderFrame.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
            sliderFrame.Parent = container

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, 0, 0, 20)
            label.BackgroundTransparency = 1
            label.TextColor3 = Color3.fromRGB(255, 255, 255)
            label.Text = text .. ": " .. tostring(default)
            label.Parent = sliderFrame

            local sliderBar = Instance.new("Frame")
            sliderBar.Size = UDim2.new(1, -20, 0, 10)
            sliderBar.Position = UDim2.new(0, 10, 0, 25)
            sliderBar.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
            sliderBar.Parent = sliderFrame

            local sliderHandle = Instance.new("TextButton")
            sliderHandle.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
            sliderHandle.Position = UDim2.new(0, 0, 0, 0)
            sliderHandle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
            sliderHandle.Text = ""
            sliderHandle.Parent = sliderBar

            local dragging = false
            sliderHandle.MouseButton1Down:Connect(function()
                dragging = true
            end)

            game:GetService("UserInputService").InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                end
            end)

            game:GetService("UserInputService").InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local relativeX = math.clamp(input.Position.X - sliderBar.AbsolutePosition.X, 0, sliderBar.AbsoluteSize.X)
                    local value = min + (relativeX / sliderBar.AbsoluteSize.X) * (max - min)
                    sliderHandle.Size = UDim2.new(relativeX / sliderBar.AbsoluteSize.X, 0, 1, 0)
                    label.Text = text .. ": " .. math.floor(value)
                    callback(value)
                end
            end)

            table.insert(tab.Controls, sliderFrame)
            return sliderFrame
        end

        table.insert(menu.Tabs, tab)
        return tab
    end

    function menu:SelectTab(name)
        for tabName, guiObjects in pairs(self.TabGuiObjects) do
            guiObjects.Container.Visible = (tabName == name)
            guiObjects.Button.BackgroundColor3 = (tabName == name) and Color3.fromRGB(100,100,100) or Color3.fromRGB(50,50,50)
        end
        self.CurrentTab = name
    end

    function menu:Show()
        self.Visible = true
        self.ScreenGui.Enabled = true
        if #self.Tabs > 0 then
            self:SelectTab(self.Tabs[1].Name)
        end
    end

    function menu:Hide()
        self.Visible = false
        self.ScreenGui.Enabled = false
    end

    return menu
end

return GUIModule
