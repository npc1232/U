local UIMenuModule = {}
UIMenuModule.__index = UIMenuModule

local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")

function UIMenuModule.new()
	local self = setmetatable({}, UIMenuModule)

	self.UI = Instance.new("ScreenGui")
	self.UI.Name = "AdvancedMenu"
	self.UI.ResetOnSpawn = false
	self.UI.IgnoreGuiInset = true
	self.UI.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")

	self.MainFrame = Instance.new("Frame")
	self.MainFrame.Size = UDim2.new(0, 400, 0, 500)
	self.MainFrame.Position = UDim2.new(0.5, -200, 0.5, -250)
	self.MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
	self.MainFrame.BorderSizePixel = 0
	self.MainFrame.Name = "MainFrame"
	self.MainFrame.Parent = self.UI

	local UICorner = Instance.new("UICorner", self.MainFrame)
	UICorner.CornerRadius = UDim.new(0, 6)

	local TopBar = Instance.new("Frame")
	TopBar.Size = UDim2.new(1, 0, 0, 35)
	TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	TopBar.BorderSizePixel = 0
	TopBar.Name = "TopBar"
	TopBar.Parent = self.MainFrame

	local Title = Instance.new("TextLabel")
	Title.Text = "Main Menu"
	Title.TextSize = 18
	Title.Font = Enum.Font.GothamBold
	Title.TextColor3 = Color3.new(1, 1, 1)
	Title.BackgroundTransparency = 1
	Title.Position = UDim2.new(0, 10, 0, 0)
	Title.Size = UDim2.new(0.7, 0, 1, 0)
	Title.TextXAlignment = Enum.TextXAlignment.Left
	Title.Parent = TopBar

	local BtnConfig = Instance.new("TextButton")
	BtnConfig.Size = UDim2.new(0, 35, 1, 0)
	BtnConfig.Position = UDim2.new(1, -70, 0, 0)
	BtnConfig.Text = "âš™"
	BtnConfig.Font = Enum.Font.GothamBold
	BtnConfig.TextSize = 18
	BtnConfig.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	BtnConfig.TextColor3 = Color3.new(1, 1, 1)
	BtnConfig.Name = "BtnConfig"
	BtnConfig.Parent = TopBar

	local BtnClose = Instance.new("TextButton")
	BtnClose.Size = UDim2.new(0, 35, 1, 0)
	BtnClose.Position = UDim2.new(1, -35, 0, 0)
	BtnClose.Text = "X"
	BtnClose.Font = Enum.Font.GothamBold
	BtnClose.TextSize = 18
	BtnClose.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	BtnClose.TextColor3 = Color3.new(1, 0.3, 0.3)
	BtnClose.Name = "BtnClose"
	BtnClose.Parent = TopBar

	local TabsFrame = Instance.new("Frame")
	TabsFrame.Size = UDim2.new(0, 100, 1, -35)
	TabsFrame.Position = UDim2.new(0, 0, 0, 35)
	TabsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	TabsFrame.BorderSizePixel = 0
	TabsFrame.Name = "Tabs"
	TabsFrame.Parent = self.MainFrame

	local ElementsHolder = Instance.new("ScrollingFrame")
	ElementsHolder.Size = UDim2.new(1, -100, 1, -35)
	ElementsHolder.Position = UDim2.new(0, 100, 0, 35)
	ElementsHolder.CanvasSize = UDim2.new(0, 0, 0, 0)
	ElementsHolder.AutomaticCanvasSize = Enum.AutomaticSize.Y
	ElementsHolder.ScrollBarThickness = 6
	ElementsHolder.BackgroundTransparency = 1
	ElementsHolder.Name = "Elements"
	ElementsHolder.Parent = self.MainFrame

	local UIListLayout = Instance.new("UIListLayout", ElementsHolder)
	UIListLayout.Padding = UDim.new(0, 6)
	UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

	local SettingsFrame = Instance.new("Frame")
	SettingsFrame.Size = UDim2.new(0, 200, 0, 120)
	SettingsFrame.Position = UDim2.new(0.5, -100, 0.5, -60)
	SettingsFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	SettingsFrame.Visible = false
	SettingsFrame.Name = "Settings"
	SettingsFrame.ZIndex = 2
	SettingsFrame.Parent = self.MainFrame

	local ColorPicker = Instance.new("TextButton")
	ColorPicker.Size = UDim2.new(1, -20, 0, 30)
	ColorPicker.Position = UDim2.new(0, 10, 0, 10)
	ColorPicker.Text = "Change Color"
	ColorPicker.Font = Enum.Font.Gotham
	ColorPicker.TextSize = 14
	ColorPicker.TextColor3 = Color3.new(1, 1, 1)
	ColorPicker.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
	ColorPicker.Parent = SettingsFrame

	local function updateColor(color)
		self.MainFrame.BackgroundColor3 = color
	end

	ColorPicker.MouseButton1Click:Connect(function()
		updateColor(Color3.fromRGB(math.random(0,255), math.random(0,255), math.random(0,255)))
	end)

	BtnConfig.MouseButton1Click:Connect(function()
		SettingsFrame.Visible = not SettingsFrame.Visible
	end)

	BtnClose.MouseButton1Click:Connect(function()
		self.UI:Destroy()
	end)

	self.ElementsHolder = ElementsHolder
	return self
end

function UIMenuModule:AddTitle(title, description)
	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Text = title
	TitleLabel.TextSize = 20
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextColor3 = Color3.new(1, 1, 1)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Size = UDim2.new(1, -10, 0, 30)
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.Parent = self.ElementsHolder

	local DescLabel = Instance.new("TextLabel")
	DescLabel.Text = description
	DescLabel.TextSize = 14
	DescLabel.Font = Enum.Font.Gotham
	DescLabel.TextColor3 = Color3.new(0.7, 0.7, 0.7)
	DescLabel.BackgroundTransparency = 1
	DescLabel.Size = UDim2.new(1, -10, 0, 20)
	DescLabel.TextXAlignment = Enum.TextXAlignment.Left
	DescLabel.Parent = self.ElementsHolder
end

function UIMenuModule:AddToggle(text, callback)
	local Toggle = Instance.new("TextButton")
	Toggle.Size = UDim2.new(1, -10, 0, 30)
	Toggle.Text = "[ OFF ] " .. text
	Toggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	Toggle.TextColor3 = Color3.new(1, 1, 1)
	Toggle.Font = Enum.Font.Gotham
	Toggle.TextSize = 14
	Toggle.Parent = self.ElementsHolder

	local state = false
	Toggle.MouseButton1Click:Connect(function()
		state = not state
		Toggle.Text = state and ("[ ON ] " .. text) or ("[ OFF ] " .. text)
		if callback then
			callback(state)
		end
	end)
end

function UIMenuModule:AddSlider(text, min, max, default, callback)
	local Slider = Instance.new("TextButton")
	Slider.Size = UDim2.new(1, -10, 0, 30)
	Slider.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	Slider.TextColor3 = Color3.new(1, 1, 1)
	Slider.Font = Enum.Font.Gotham
	Slider.TextSize = 14
	Slider.Text = text .. ": " .. default
	Slider.Parent = self.ElementsHolder

	local value = default
	Slider.MouseButton1Click:Connect(function()
		value = math.clamp(value + 1, min, max)
		Slider.Text = text .. ": " .. value
		if callback then
			callback(value)
		end
	end)
end

function UIMenuModule:AddImageButton(imageId, callback)
	local Button = Instance.new("ImageButton")
	Button.Size = UDim2.new(0, 40, 0, 40)
	Button.BackgroundTransparency = 1
	Button.Image = "rbxassetid://" .. imageId
	Button.Parent = self.ElementsHolder
	Button.MouseButton1Click:Connect(function()
		if callback then
			callback()
		end
	end)
end

return UIMenuModule
